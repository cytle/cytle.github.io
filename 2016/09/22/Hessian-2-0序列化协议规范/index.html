<!DOCTYPE html>
<html lang="zh-Hans">
  <head>
    
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">



  <meta name="description" content="Hessian-2.0序列化协议规范"/>




  <meta name="keywords" content="Hessian, xsp" />










  <link rel="alternate" href="/atom.xml" title="xsp">




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2.6.0" />



<link rel="canonical" href="https://cytle.github.io/2016/09/22/Hessian-2-0序列化协议规范/"/>


<link rel="stylesheet" type="text/css" href="/css/style.css?v=2.6.0" />






  



  <script id="baidu_push">
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>





  <script src="//cdn1.lncld.net/static/js/3.1.1/av-min.js"></script>
  <script id="leancloud">
    AV.init({
      appId: "XX5UNu0LFrK6VkLgVS7GygfL-gzGzoHsz",
      appKey: "pBlnYAs9URL4nuKQqCu6q4Jp"
    });
  </script>





    <title> Hessian-2.0序列化协议规范 - xsp </title>
  </head>

  <body><div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/." class="logo">xsp</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>

<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    
      <a href="/">
        <li class="mobile-menu-item">
          
          
            Home
          
        </li>
      </a>
    
      <a href="/archives/">
        <li class="mobile-menu-item">
          
          
            Archives
          
        </li>
      </a>
    
      <a href="/tags">
        <li class="mobile-menu-item">
          
          
            Tags
          
        </li>
      </a>
    
  </ul>
</nav>

    <div class="container" id="mobile-panel">
      <header id="header" class="header"><div class="logo-wrapper">
  <a href="/." class="logo">xsp</a>
</div>

<nav class="site-navbar">
  
    <ul id="menu" class="menu">
      
        <li class="menu-item">
          <a class="menu-item-link" href="/">
            
            
              Home
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/archives/">
            
            
              Archives
            
          </a>
        </li>
      
        <li class="menu-item">
          <a class="menu-item-link" href="/tags">
            
            
              Tags
            
          </a>
        </li>
      
    </ul>
  
</nav>

      </header>

      <main id="main" class="main">
        <div class="content-wrapper">
          <div id="content" class="content">
            
  
  <article class="post">
    <header class="post-header">
      <h1 class="post-title">
        
          Hessian-2.0序列化协议规范
        
      </h1>

      <div class="post-meta">
        <span class="post-time">
          2016-09-22
        </span>
        
        
        <div class="post-visits"
             data-url="/2016/09/22/Hessian-2-0序列化协议规范/"
             data-title="Hessian-2.0序列化协议规范">
            阅读次数
          </div>
        
      </div>
    </header>

    
    
  <div class="post-toc" id="post-toc">
    <h2 class="post-toc-title">Contents</h2>
    <div class="post-toc-content">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-概述"><span class="toc-text">1.概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-设计目标"><span class="toc-text">2.设计目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Hessian语法"><span class="toc-text">3. Hessian语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-序列化"><span class="toc-text">4. 序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-二进制数据"><span class="toc-text">4.1. 二进制数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-压缩格式：短二进制"><span class="toc-text">4.1.1. 压缩格式：短二进制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-Binary实例"><span class="toc-text">4.1.2. Binary实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-boolean"><span class="toc-text">4.2. boolean</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-Boolean实例"><span class="toc-text">4.2.1. Boolean实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-date"><span class="toc-text">4.3.    date</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-3-1-Date实例"><span class="toc-text">4.3.1. Date实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-double"><span class="toc-text">4.4. double</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-1-压缩格式：double表示的0"><span class="toc-text">4.4.1. 压缩格式：double表示的0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-2-压缩格式：double-表示的1"><span class="toc-text">4.4.2. 压缩格式：double 表示的1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-3-压缩格式：单字节double"><span class="toc-text">4.4.3. 压缩格式：单字节double</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-4-压缩格式：short型double"><span class="toc-text">4.4.4. 压缩格式：short型double</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-5-float型double"><span class="toc-text">4.4.5. float型double</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-6-Double实例"><span class="toc-text">4.4.6. Double实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-int"><span class="toc-text">4.5. int</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-1-单字节整型"><span class="toc-text">4.5.1. 单字节整型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-2-双字节整型"><span class="toc-text">4.5.2. 双字节整型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-3-三字节整型"><span class="toc-text">4.5.3. 三字节整型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-5-4-整型实例"><span class="toc-text">4.5.4. 整型实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-list"><span class="toc-text">4.6. list</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-1-压缩格式-repeated-list"><span class="toc-text">4.6.1. 压缩格式: repeated list</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-6-2-List实例"><span class="toc-text">4.6.2. List实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-long"><span class="toc-text">4.7. long</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-1-压缩格式-单字节long"><span class="toc-text">4.7.1. 压缩格式: 单字节long</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-2-压缩格式-双字节long"><span class="toc-text">4.7.2. 压缩格式: 双字节long</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-3-压缩格式-3字节long"><span class="toc-text">4.7.3. 压缩格式: 3字节long</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-4-压缩格式-四字节long"><span class="toc-text">4.7.4. 压缩格式: 四字节long</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-7-5-long实例"><span class="toc-text">4.7.5. long实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-map"><span class="toc-text">4.8.    map</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-8-1-Map实例"><span class="toc-text">4.8.1. Map实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-null"><span class="toc-text">4.9. null</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-对象-object"><span class="toc-text">4.10. 对象(object)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-1-压缩格式-class定义"><span class="toc-text">4.10.1. 压缩格式: class定义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-2-压缩格式-对象实例"><span class="toc-text">4.10.2. 压缩格式: 对象实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-10-3-对象实例"><span class="toc-text">4.10.3. 对象实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11-引用-ref"><span class="toc-text">4.11. 引用(ref)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-11-1-压缩格式-双字节引用"><span class="toc-text">4.11.1. 压缩格式: 双字节引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-11-2-压缩格式-三字节引用"><span class="toc-text">4.11.2. 压缩格式: 三字节引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-11-3-引用实例"><span class="toc-text">4.11.3. 引用实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-12-string"><span class="toc-text">4.12. string</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-12-1-压缩格式-短字符串"><span class="toc-text">4.12.1. 压缩格式: 短字符串</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-12-2-字符串实例"><span class="toc-text">4.12.2. 字符串实例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-13-类型-type"><span class="toc-text">4.13. 类型(type)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-14-压缩格式-类型引用"><span class="toc-text">4.14. 压缩格式: 类型引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-引用表-Reference-Map"><span class="toc-text">5. 引用表(Reference Map)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-值引用"><span class="toc-text">5.1. 值引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-class引用"><span class="toc-text">5.2. class引用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-type引用"><span class="toc-text">5.3. type引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-字节码映射表-Bytecode-map"><span class="toc-text">6. 字节码映射表(Bytecode map)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#附录"><span class="toc-text">附录</span></a></li></ol>
    </div>
  </div>


    <div class="post-content">
      
        <p>翻译: Edison peng</p>
<p><a href="/uploads/hessian协议中文版.docx">word版下载</a></p>
<h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><p><code>Hessian</code>是一个轻量级的,自定义描述的二进制RPC协议。<code>Hessian</code>主要用作面向对象的消息通信。</p>
<h2 id="2-设计目标"><a href="#2-设计目标" class="headerlink" title="2.设计目标"></a>2.设计目标</h2><p><code>Hessian</code>的初衷是支持动态类型，格式紧凑，跨语言.</p>
<p><code>Hessian</code>协议的设计目标如下:</p>
<ul>
<li>可序列化类型必须是可以自描述的, i.e. 不需要额外的模式(schema)或接口定义.</li>
<li>必须是语言独立的, 包括对脚本语言的支持.</li>
<li>It must be readable or writable in a single pass.</li>
<li>必须设计紧凑.</li>
<li>必须足够简单，以便测试和实现.</li>
<li>高效率.</li>
<li>必须支持Unicode字符集.</li>
<li>支持8-bit二进制数据，without escaping or using attachments.</li>
<li>必须支持加密, 压缩, 签名 and transaction context envelopes.</li>
</ul>
<h2 id="3-Hessian语法"><a href="#3-Hessian语法" class="headerlink" title="3. Hessian语法"></a>3. <code>Hessian</code>语法</h2><p>序列化语法
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">        #starting production</span><br><span class="line">top     ::=value</span><br><span class="line"></span><br><span class="line">        #分割成64k每chunk的8-bit二进制数据</span><br><span class="line">binary  ::= &apos;b&apos; b1 b0 &lt;binary-data&gt; binary  #不是最后一个chunk</span><br><span class="line">        ::= &apos;B&apos; b1 b0 &lt;binary-data&gt;         #最后一个chunk</span><br><span class="line">        ::= [x20-x2f] &lt;binary-data&gt;         #长度范围为 0-15</span><br><span class="line"></span><br><span class="line">        #boolean true/false</span><br><span class="line">boolean ::= &apos;T&apos;</span><br><span class="line">        ::= &apos;F&apos;</span><br><span class="line"></span><br><span class="line">        #对象的定义(compact map)</span><br><span class="line">class-def ::= &apos;O&apos; type int string*</span><br><span class="line"></span><br><span class="line">        #time in UTC encoded as 64-bit long milliseconds since epoch</span><br><span class="line">date    ::= &apos;d&apos; b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line"></span><br><span class="line">        #64-bit IEEE double</span><br><span class="line">double  ::= &apos;D&apos; b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">        ::= x67                         #0.0</span><br><span class="line">        ::= x68                         #1.0</span><br><span class="line">        ::= x69 b0                      #byte表示的double(-128.0 to 127.0)</span><br><span class="line">        ::= x6a b1 b0                   #short表示的double</span><br><span class="line">        ::= x6b b3 b2 b1 b0             #32-bit float表示的double</span><br><span class="line"></span><br><span class="line">        #32-bit 有符号整型</span><br><span class="line">int     ::= &apos;I&apos; b3 b2 b1 b0</span><br><span class="line">        ::= [x80-xbf]                   #-x10 to x3f</span><br><span class="line">        ::= [xc0-xcf] b0                #-x800 to x7ff</span><br><span class="line">        ::= [xd0-xd7] b1 b0             #-x40000 to x3ffff</span><br><span class="line"></span><br><span class="line">        # list/vector length</span><br><span class="line">length  ::= &apos;l&apos; b3 b2 b1 b0</span><br><span class="line">        ::= x6e int</span><br><span class="line"></span><br><span class="line">        # list/vector</span><br><span class="line">list    ::= &apos;V&apos; type? length? value* &apos;z&apos;</span><br><span class="line">        ::= &apos;v&apos; int int value*          #第一个int表示类型引用, 第二个int表示长度</span><br><span class="line"></span><br><span class="line">        #64-bit有符号long</span><br><span class="line">long    ::= &apos;L&apos; b7 b6 b5 b4 b3 b2 b1 0</span><br><span class="line">        ::= [xd8-xef]                   #-x08 to x0f</span><br><span class="line">        ::= [xf0-xff] b0                #-x800 to x7ff</span><br><span class="line">        ::= [x38-x3f] b1 b0             #-x40000 to x3ffff</span><br><span class="line">        ::= x77 b3 b2 b1 b0             #32-bit 整型表示的long</span><br><span class="line"></span><br><span class="line">        #map/object</span><br><span class="line">map     ::= &apos;M&apos; type? (value value)* &apos;z&apos;    #key, value map pairs</span><br><span class="line"></span><br><span class="line">        # null value</span><br><span class="line">null    ::= &apos;N&apos;</span><br><span class="line"></span><br><span class="line">        #对象实例</span><br><span class="line">object  ::= &apos;o&apos; int value*</span><br><span class="line"></span><br><span class="line">        #值引用</span><br><span class="line">ref     ::= &apos;R&apos; b3 b2 b1 b0 # 对流中第n个map/list/object的引用</span><br><span class="line"></span><br><span class="line">        ::= x4a b0          # 对map/list/object的引用，范围为1-255th</span><br><span class="line">        ::= x4b b1 b0       # 对map/list/object 的引用，范围为1-65535th</span><br><span class="line"></span><br><span class="line">        #UTF-8 编码的字符串，分割成64k大小的chunks</span><br><span class="line">string  ::= &apos;s&apos; b1 b0 &lt;utf8-data&gt; string    #非末尾chunk</span><br><span class="line">        ::= &apos;S&apos; b1 b0 &lt;utf8-data&gt;           #长度范围为(0-65535)的字符串</span><br><span class="line">        ::=[x00-x1f] &lt;utf8-data&gt;            #长度范围为(0-31) 的字符串</span><br><span class="line"></span><br><span class="line">        #map/list 的类型（针对面向对象语言)</span><br><span class="line">type    ::= &apos;t&apos; b1 b0 &lt;type-string&gt;     #类型名称</span><br><span class="line">        ::= x75 int                     #类型引用值（用整数表示）</span><br><span class="line"></span><br><span class="line">        #main production</span><br><span class="line">value   ::=null</span><br><span class="line">        ::= binary</span><br><span class="line">        ::= boolean</span><br><span class="line">        ::= date</span><br><span class="line">        ::= double</span><br><span class="line">        ::= int</span><br><span class="line">        ::= list</span><br><span class="line">        ::= long</span><br><span class="line">        ::= map</span><br><span class="line">        ::= class-def value</span><br><span class="line">        ::= ref</span><br><span class="line">        ::= string</span><br></pre></td></tr></table></figure></p>
<h2 id="4-序列化"><a href="#4-序列化" class="headerlink" title="4. 序列化"></a>4. 序列化</h2><p><code>Hessian</code>的对象序列化机制包含8种基本类型:</p>
<ol>
<li>原始二进制数据</li>
<li>boolean</li>
<li>64-bit date</li>
<li>64-bit double</li>
<li>32-bit int</li>
<li>64-bit long</li>
<li>null</li>
<li>UTF8编码的string</li>
</ol>
<p>另外包括3种递归类型：</p>
<ol>
<li>list for lists and arrays</li>
<li>map for maps and dictionaries</li>
<li>object for objects</li>
</ol>
<p>最后，它还包含一个特殊的类型：</p>
<ol>
<li>ref 用来表示对共享对象的引用.</li>
</ol>
<p><code>Hessian</code> 2.0有3个内部的引用表:</p>
<ol>
<li>一个object/list 引用表.</li>
<li>一个类型定义(class definition)引用表.</li>
<li>一个type(class name)引用表.</li>
</ol>
<h3 id="4-1-二进制数据"><a href="#4-1-二进制数据" class="headerlink" title="4.1. 二进制数据"></a>4.1. 二进制数据</h3><p>二进制数据语法
binary  ::= b b1 b0 <binary-data> binary
        ::= B b1 b0 <binary-data>
        ::= [x20-x2f] <binary-data></binary-data></binary-data></binary-data></p>
<p>二进制数据被分割成chunk. 十六进制数x42(‘B’)标识最后一个chunk,x62(‘b’)标识普通的chunk.
每个chunk有一个16-bit的长度值.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len = <span class="number">256</span>*b1 + b0</span><br></pre></td></tr></table></figure>
<h4 id="4-1-1-压缩格式：短二进制"><a href="#4-1-1-压缩格式：短二进制" class="headerlink" title="4.1.1. 压缩格式：短二进制"></a>4.1.1. 压缩格式：短二进制</h4><p>长度小于15的二进制数据只需要用单个十六进制数字来表示[x20-x2f].</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">len = code - <span class="number">0x20</span></span><br></pre></td></tr></table></figure>
<h4 id="4-1-2-Binary实例"><a href="#4-1-2-Binary实例" class="headerlink" title="4.1.2. Binary实例"></a>4.1.2. Binary实例</h4><p>x20             #零长度的二进制数据
x23 x01 x02 x03     #长度为3的数据
B x10 x00 ….      #4k大小的final chunk
b x04 x00 ….      #1k大小的non-final chunk</p>
<h3 id="4-2-boolean"><a href="#4-2-boolean" class="headerlink" title="4.2. boolean"></a>4.2. boolean</h3><p>Boolean语法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">boolean  ::= T</span><br><span class="line">         ::= F</span><br></pre></td></tr></table></figure>
<p>用16进制’F’来表示false,用’T’表示true.</p>
<h4 id="4-2-1-Boolean实例"><a href="#4-2-1-Boolean实例" class="headerlink" title="4.2.1. Boolean实例"></a>4.2.1. Boolean实例</h4><p>T # true
F # false</p>
<h3 id="4-3-date"><a href="#4-3-date" class="headerlink" title="4.3.    date"></a>4.3.    date</h3><p>date ::=d b7 b6 b5 b4 b3 b2 b1 b0</p>
<p>Date采用64-bit来表示距1970 00:00H, UTC以来经过的milliseconds.</p>
<h4 id="4-3-1-Date实例"><a href="#4-3-1-Date实例" class="headerlink" title="4.3.1. Date实例"></a>4.3.1. Date实例</h4><p>D x00 x00 xd0 x4b x92 x84 xb8   #2:51:31 May 8, 1998 UTC</p>
<h3 id="4-4-double"><a href="#4-4-double" class="headerlink" title="4.4. double"></a>4.4. double</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">double  ::= D b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">        ::= x67</span><br><span class="line">        ::= x68</span><br><span class="line">        ::= x69 b0</span><br><span class="line">        ::= x6a b1 b0</span><br><span class="line">        ::= x6b b3 b2 b1 b0</span><br></pre></td></tr></table></figure>
<p>符合IEEE标准的 64-bit浮点数.</p>
<h4 id="4-4-1-压缩格式：double表示的0"><a href="#4-4-1-压缩格式：double表示的0" class="headerlink" title="4.4.1. 压缩格式：double表示的0"></a>4.4.1. 压缩格式：double表示的0</h4><p>0.0用十六进制x67来表示  （对应ascii中字符g的ascii值）</p>
<h4 id="4-4-2-压缩格式：double-表示的1"><a href="#4-4-2-压缩格式：double-表示的1" class="headerlink" title="4.4.2. 压缩格式：double 表示的1"></a>4.4.2. 压缩格式：double 表示的1</h4><p>1.0用十六进制x68来表示</p>
<h4 id="4-4-3-压缩格式：单字节double"><a href="#4-4-3-压缩格式：单字节double" class="headerlink" title="4.4.3. 压缩格式：单字节double"></a>4.4.3. 压缩格式：单字节double</h4><p>介于-128.0和127.0之间的无小数位的double型可以用两个十六进制来表示(如x3b表示的),也即相当于一个byte值转换成double:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (<span class="keyword">double</span>)b0</span><br></pre></td></tr></table></figure>
<h4 id="4-4-4-压缩格式：short型double"><a href="#4-4-4-压缩格式：short型double" class="headerlink" title="4.4.4. 压缩格式：short型double"></a>4.4.4. 压缩格式：short型double</h4><p>介于-32768.0和32767.0之间的无小数位的double型可以用3个十六进制数来表示，也即相当于一个short值转换成double:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value=(<span class="keyword">double</span>)(<span class="number">256</span>*b1 + b0)</span><br></pre></td></tr></table></figure>
<h4 id="4-4-5-float型double"><a href="#4-4-5-float型double" class="headerlink" title="4.4.5. float型double"></a>4.4.5. float型double</h4><p>和32-bit float型等价的double能够用4个十六进制的 float来表示.</p>
<h4 id="4-4-6-Double实例"><a href="#4-4-6-Double实例" class="headerlink" title="4.4.6. Double实例"></a>4.4.6. Double实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">x67             # 0.0</span><br><span class="line">x68             # 1.0</span><br><span class="line"></span><br><span class="line">x69 x00         # 0.0</span><br><span class="line">x69 x80         # -128.0</span><br><span class="line">x69 xff         # 127.0</span><br><span class="line"></span><br><span class="line">x70 x00 x00     # 0.0</span><br><span class="line">x70 x80 x00     # -32768.0</span><br><span class="line">x70 xff xff         # 32767.0</span><br><span class="line"></span><br><span class="line">D x40 x28 x80 x00 x00 x00 x00 x00       # 12.25</span><br></pre></td></tr></table></figure>
<h3 id="4-5-int"><a href="#4-5-int" class="headerlink" title="4.5. int"></a>4.5. int</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int ::= ’I’ b3 b2 b1 b0</span><br><span class="line">    ::= [x80-xbf]</span><br><span class="line">    ::= [xc0-xcf]   b0</span><br><span class="line">    ::= [xd0-xd7] b1 b0</span><br></pre></td></tr></table></figure>
<p>32-bit的有符号整型. 一个整型由跟随在x49(‘I’)之后的4个大端序(big-endian)排位的十六进制数来表示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (b3&lt;&lt;<span class="number">24</span>) + (b2&lt;&lt;<span class="number">16</span>) + (b1&lt;&lt;<span class="number">8</span>)  + b0;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-1-单字节整型"><a href="#4-5-1-单字节整型" class="headerlink" title="4.5.1. 单字节整型"></a>4.5.1. 单字节整型</h4><p>介于-16和47之间的整型可以用单个字节来表示，用十六进制来表示范围为x80到xbf.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = code – 0x90     # 这里是0x90, 如果code=x80，则value = x80 – x90 = -16.:-)</span><br></pre></td></tr></table></figure>
<h4 id="4-5-2-双字节整型"><a href="#4-5-2-双字节整型" class="headerlink" title="4.5.2. 双字节整型"></a>4.5.2. 双字节整型</h4><p>介于-2048和2047之间的整型可以用两个字节来表示，头字节的范围从xc0到xcf.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ((code – <span class="number">0xc8</span>)&lt;&lt;<span class="number">8</span>) + b0;</span><br></pre></td></tr></table></figure>
<h4 id="4-5-3-三字节整型"><a href="#4-5-3-三字节整型" class="headerlink" title="4.5.3. 三字节整型"></a>4.5.3. 三字节整型</h4><p>介于- 262144和262143之间的整型可以用三个字节来表示，头字节的范围从xd0到xd7.</p>
<h4 id="4-5-4-整型实例"><a href="#4-5-4-整型实例" class="headerlink" title="4.5.4. 整型实例"></a>4.5.4. 整型实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">x90                 # 0</span><br><span class="line">x80                 # -16</span><br><span class="line">xbf                 # 47</span><br><span class="line"></span><br><span class="line">xc8 x00             # 0</span><br><span class="line">xc0 x00             # -2048</span><br><span class="line">xc7 x00             # -256</span><br><span class="line">xcf xff             # 2047</span><br><span class="line"></span><br><span class="line">xd4 x00 x00         # 0</span><br><span class="line">xd0 x00 x00         # -262144</span><br><span class="line">xd7 xff xff         # 262143</span><br><span class="line"></span><br><span class="line">I x00 x00 x00 x00   # 0</span><br><span class="line">I x00 x00 x01 x2c   # 300</span><br></pre></td></tr></table></figure>
<h3 id="4-6-list"><a href="#4-6-list" class="headerlink" title="4.6. list"></a>4.6. list</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list    ::= V type? length? value* z</span><br><span class="line">        ::= V int int value*</span><br></pre></td></tr></table></figure>
<p>一个有序列表.每个list都包含一个type字符串，长度length和一个值列表，以十六进制x7a(‘z’)作为结尾。Type可以是任意的UTF-8编码的字符串。Length指定了list值列表的长度。</p>
<p>list的每个值都被添加到一个引用列表中，这样，所有list中的相同条目都共享同一份引用以节省空间。</p>
<blockquote>
<p>Any parser expecting a list must also accept a null or a shared ref.</p>
</blockquote>
<p>Type的有效取值在文档中并没有详细指定，这依赖于特定的应用. 比如， 在一个由静态类型语言实现的server所暴露的<code>Hessian</code>接口可以使用类型信息来实例化特定的数组类型，反之，在一个由动态类型语言(e.g.: python)实现的server中，将会忽略类型信息。</p>
<h4 id="4-6-1-压缩格式-repeated-list"><a href="#4-6-1-压缩格式-repeated-list" class="headerlink" title="4.6.1. 压缩格式: repeated list"></a>4.6.1. 压缩格式: repeated list</h4><p><code>Hessian</code>2.0 制定了一个格式紧凑的list，其中list元素类型type和元素个数length都用整型来编码，其中类型type是对先前定义的原始数据类型的引用。</p>
<h4 id="4-6-2-List实例"><a href="#4-6-2-List实例" class="headerlink" title="4.6.2. List实例"></a>4.6.2. List实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">强类型int数组的序列化: int[] = &#123;0, 1&#125;</span><br><span class="line"></span><br><span class="line">V</span><br><span class="line">    t x00 x04 [int  # int[] 类型的编码</span><br><span class="line">    x6e x02         # length = 2</span><br><span class="line">    x90             # 整数 0</span><br><span class="line">    x91             # 整数 1</span><br><span class="line">    z</span><br><span class="line"></span><br><span class="line">匿名变长list = &#123;0, &quot;foobar&quot;&#125;</span><br><span class="line">V</span><br><span class="line">    t x00 x04 [int      # int[] 类型编码</span><br><span class="line">    x6e x02             # length = 2</span><br><span class="line">    x90                 # 整数0</span><br><span class="line">    x91                 # 整数1</span><br><span class="line">    z</span><br><span class="line"></span><br><span class="line">Repeated list类型</span><br><span class="line"></span><br><span class="line">V</span><br><span class="line">    t x00 x04 [int      # int[]类型编码</span><br><span class="line">    x63 x02             # length=2</span><br><span class="line">    x90                 # 整数 0</span><br><span class="line">    x91                 # 整数 1</span><br><span class="line">    z</span><br><span class="line"></span><br><span class="line">V</span><br><span class="line">    x91             # int[]的类型引用    (integer #1)</span><br><span class="line">    x92             # length = 2</span><br><span class="line">    x92             # 整数2</span><br><span class="line">    x93             # 整数3</span><br></pre></td></tr></table></figure>
<h3 id="4-7-long"><a href="#4-7-long" class="headerlink" title="4.7. long"></a>4.7. long</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">long    ::= L b7 b6 b5 b4 b3 b2 b1 b0</span><br><span class="line">        ::= [xd8-xef]</span><br><span class="line">        ::= [xf0-xff] b0</span><br><span class="line">        ::= [x38-x3f] b1 b0</span><br><span class="line">        ::= x77 b3 b2 b1 b0</span><br></pre></td></tr></table></figure>
<p>一个64-bit的有符号整数. 起头由十六进制x4c(‘L’)标识, 后面为8字节的大端（big-endian）序的整数。</p>
<h4 id="4-7-1-压缩格式-单字节long"><a href="#4-7-1-压缩格式-单字节long" class="headerlink" title="4.7.1. 压缩格式: 单字节long"></a>4.7.1. 压缩格式: 单字节long</h4><p>介于-8和15之间的long由单个字节表示，范围为xd8到xef.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (code – <span class="number">0xe0</span>)</span><br></pre></td></tr></table></figure>
<h4 id="4-7-2-压缩格式-双字节long"><a href="#4-7-2-压缩格式-双字节long" class="headerlink" title="4.7.2. 压缩格式: 双字节long"></a>4.7.2. 压缩格式: 双字节long</h4><p>介于-2048和2047之间的long由两个字节标识, 起头字节的取值范围为xf0到xff.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ((code – <span class="number">0xf8</span>)&lt;&lt;<span class="number">8</span>) + b0</span><br></pre></td></tr></table></figure>
<h4 id="4-7-3-压缩格式-3字节long"><a href="#4-7-3-压缩格式-3字节long" class="headerlink" title="4.7.3. 压缩格式: 3字节long"></a>4.7.3. 压缩格式: 3字节long</h4><p>介于-262144和262143之间的long由3个字节编码，起头字节的取值范围为x38到x3f.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = ((code – <span class="number">0x3c</span>)&lt;&lt;<span class="number">16</span>) + (b1&lt;&lt;<span class="number">8</span>) + b0</span><br></pre></td></tr></table></figure>
<h4 id="4-7-4-压缩格式-四字节long"><a href="#4-7-4-压缩格式-四字节long" class="headerlink" title="4.7.4. 压缩格式: 四字节long"></a>4.7.4. 压缩格式: 四字节long</h4><p>可以用32-bit的整数来标识的long在这里需要用5个字节作编码,起头字节由x77标识.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (b3&lt;&lt;<span class="number">24</span>) + (b2&lt;&lt;<span class="number">16</span>) + (b1&lt;&lt;<span class="number">8</span>) + b0</span><br></pre></td></tr></table></figure>
<h4 id="4-7-5-long实例"><a href="#4-7-5-long实例" class="headerlink" title="4.7.5. long实例"></a>4.7.5. long实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">xe0                                 # 0</span><br><span class="line">xd8                                 # -8</span><br><span class="line">xef                                 # 15</span><br><span class="line"></span><br><span class="line">xf8 x00                             # 0</span><br><span class="line">xf0 x00                             # -2048</span><br><span class="line">xf7 x00                             # -256</span><br><span class="line">xff xff                             # 2047</span><br><span class="line"></span><br><span class="line">x3c x00 x00                         # 0</span><br><span class="line">x38 x00 x00                         # -262144</span><br><span class="line">x3f xff xff                         # 262143</span><br><span class="line"></span><br><span class="line">x77 x00 x00 x00 x00                 # 0</span><br><span class="line">x77 x00 x00 x01 x2c                 # 300</span><br><span class="line"></span><br><span class="line">L x00 x00 x00 x00 x00 x00 x01 x2c   # 300</span><br></pre></td></tr></table></figure>
<h3 id="4-8-map"><a href="#4-8-map" class="headerlink" title="4.8.    map"></a>4.8.    map</h3><p>map ::= M type? (value value)* z</p>
<p>用来表示序列化map和对象. Type字段用来表示map类型，type可能为空（例如在length为0的情况下）。如果类型未指定，则由解析器来负责选择类型。对于对象而言,不识别的key将会被忽略.
所有map元素也被存入一个引用列表. 在解析map时，可以同时支持空类型和引用类型。
类型由服务具体来进行选择。</p>
<h4 id="4-8-1-Map实例"><a href="#4-8-1-Map实例" class="headerlink" title="4.8.1. Map实例"></a>4.8.1. Map实例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">1</span>), <span class="string">"fee"</span>);</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">16</span>), <span class="string">"fie"</span>);</span><br><span class="line">map.put(<span class="keyword">new</span> Integer(<span class="number">256</span>), <span class="string">"foe"</span>);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">M</span><br><span class="line">    x91         # 1</span><br><span class="line">    x03 fee     # &quot;fee&quot;</span><br><span class="line"></span><br><span class="line">    xa0         # 16</span><br><span class="line">    x03 fie     # &quot;fie&quot;</span><br><span class="line"></span><br><span class="line">    xb9 x00     # 256</span><br><span class="line">    x03 foe     # &quot;foe&quot;</span><br><span class="line">    z</span><br></pre></td></tr></table></figure>
<p>由java对象表示的Map对象:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">Car</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    String color = <span class="string">"aquamarine"</span></span><br><span class="line">    String model = <span class="string">"Beetle"</span>;</span><br><span class="line">    Int mileage = <span class="number">65536</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">M</span><br><span class="line">    t x00 x13 com.caucho.test.Car   #type</span><br><span class="line">    x05 color                       # color field</span><br><span class="line">    x0a aquamarine</span><br><span class="line"></span><br><span class="line">    x05 model                   # model field</span><br><span class="line">    x06 Beetle</span><br><span class="line"></span><br><span class="line">    x07 mileage                 #mileage field</span><br><span class="line">    I x00 x01 x00 x00</span><br><span class="line">    z</span><br></pre></td></tr></table></figure>
<h3 id="4-9-null"><a href="#4-9-null" class="headerlink" title="4.9. null"></a>4.9. null</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">null    ::= N</span><br></pre></td></tr></table></figure>
<p>null表示一个空指针。字符’N’用来标识null值。</p>
<h3 id="4-10-对象-object"><a href="#4-10-对象-object" class="headerlink" title="4.10. 对象(object)"></a>4.10. 对象(object)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">object      ::= ‘o’ int value*</span><br><span class="line">class-def   ::= ’O’ type int string*</span><br></pre></td></tr></table></figure>
<h4 id="4-10-1-压缩格式-class定义"><a href="#4-10-1-压缩格式-class定义" class="headerlink" title="4.10.1. 压缩格式: class定义"></a>4.10.1. 压缩格式: class定义</h4><p><code>Hessian</code> 2.0制定了一个紧凑的对象格式，其中字段名只需要序列化一次。对于对象而言，仅需要按次序地序列化这些字段的取值.</p>
<p>类定义包括类型字符串,字段个数,所有的字段名. 类定义被存放在一个对象定义表中,每个类定义由一个唯一整数作为key标识，之后被对象实例通过key来引用。</p>
<h4 id="4-10-2-压缩格式-对象实例"><a href="#4-10-2-压缩格式-对象实例" class="headerlink" title="4.10.2. 压缩格式: 对象实例"></a>4.10.2. 压缩格式: 对象实例</h4><p>对象实例基于先前定义来创建一个新的对象实例. 类定义通过一个整型key在类定义表中进行查询。</p>
<h4 id="4-10-3-对象实例"><a href="#4-10-3-对象实例" class="headerlink" title="4.10.3. 对象实例"></a>4.10.3. 对象实例</h4><p>对象序列化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class Car&#123;</span><br><span class="line">    String color;</span><br><span class="line">    String model;</span><br><span class="line">&#125;</span><br><span class="line">out.wirteObject(<span class="keyword">new</span> Car(<span class="string">"red"</span>, <span class="string">"corvette"</span>));</span><br><span class="line">out.writeObject(<span class="keyword">new</span> Car(<span class="string">"green"</span>, <span class="string">"civic"</span>));</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">O                           # 类型定义  (假定在类型表中对应key为 0)</span><br><span class="line">    t x00 x0b example.Car   # 类型为example.Car</span><br><span class="line">    x92                     # 两个字段</span><br><span class="line">    x05 color               # color字段名</span><br><span class="line">    x05 model               # model字段名</span><br><span class="line"></span><br><span class="line">o</span><br><span class="line">    x90                     # 对象定义 (类型引用key=0)</span><br><span class="line">    x03 red                 # color字段取值</span><br><span class="line">    x08 corvette            # model字段取值</span><br><span class="line"></span><br><span class="line">o</span><br><span class="line">    x90                     # 对象定义 (类型引用key=0)</span><br><span class="line">    x05 green               # color字段取值</span><br><span class="line">    x05 civic               # model字段取值</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> Color&#123;</span><br><span class="line">    RED,</span><br><span class="line">    GREEN,</span><br><span class="line">    BLUE</span><br><span class="line">&#125;</span><br><span class="line">out.writeObject(Color.RED);</span><br><span class="line">out.writeObject(Color.GREEN);</span><br><span class="line">out.writeObject(Color.BLUE);</span><br><span class="line">out.writeObject(Color.GREEN);</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">O                               # 类型定义 (假定在类型表中对应key为 0)</span><br><span class="line">    t x00 x0b example.Color     # 类型为example.Color</span><br><span class="line">    x91                         # 一个字段</span><br><span class="line">    x04 name                    # 枚举字段为&quot;name&quot;</span><br><span class="line"></span><br><span class="line">o                               # 对象 #0</span><br><span class="line">    x90                         # 对象定义 (类型引用key=0)</span><br><span class="line">    x03 RED                     # RED</span><br><span class="line"></span><br><span class="line">o                               # 对象 #1</span><br><span class="line">    x90                         # 对象定义 (类型引用key=0)</span><br><span class="line">    x05 GREEN                   # GREEN</span><br><span class="line"></span><br><span class="line">o                               # 对象 #2</span><br><span class="line">    x90                         # 对象定义 (类型引用key=0)</span><br><span class="line">    x05 BLUE                    # BLUE</span><br><span class="line"></span><br><span class="line">x4a x01                         # 对象引用 #1</span><br></pre></td></tr></table></figure>
<h3 id="4-11-引用-ref"><a href="#4-11-引用-ref" class="headerlink" title="4.11. 引用(ref)"></a>4.11. 引用(ref)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ref ::= R b3 b2 b1 b0</span><br><span class="line">    ::= x4a b0</span><br><span class="line">    ::= x4b b1 b0</span><br></pre></td></tr></table></figure>
<p>以一个整数作为key,引用之前所定义的list, map或者对象实例. 对于从输入流中读取出来的每个list, map或对象, 都在流中按位置次序作为标识, i.e. 第一个list或者map为’0’, 下一个为’1’等等. 之后的引用能够使用先前的对象. Writers MAY生成引用. Parsers MUST 识别引用.</p>
<blockquote>
<p>ref can refer to incompletely-read items. For example, a circular linked-list will refer to the first link before the entire list has been read.</p>
<p>A possible implementation would add each map, list, and object to an array as it is read. The ref will return the corresponding value from the array. To support circular structures, the implementation would store the map, list or object immediately, before filling in the contents.</p>
<p>Each map or list is stored into an array as it is parsed. ref selects one of the stored objects. The first object is numbered ‘0’.</p>
</blockquote>
<h4 id="4-11-1-压缩格式-双字节引用"><a href="#4-11-1-压缩格式-双字节引用" class="headerlink" title="4.11.1. 压缩格式: 双字节引用"></a>4.11.1. 压缩格式: 双字节引用</h4><p>介于0和255之间的引用编号可以用两个字节来编码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = b0</span><br></pre></td></tr></table></figure>
<h4 id="4-11-2-压缩格式-三字节引用"><a href="#4-11-2-压缩格式-三字节引用" class="headerlink" title="4.11.2. 压缩格式: 三字节引用"></a>4.11.2. 压缩格式: 三字节引用</h4><p>介于0和255之间的引用编号可以用三个字节来编码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = (b1&lt;&lt;<span class="number">8</span>) + b0</span><br></pre></td></tr></table></figure>
<h4 id="4-11-3-引用实例"><a href="#4-11-3-引用实例" class="headerlink" title="4.11.3. 引用实例"></a>4.11.3. 引用实例</h4><p>循环链表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">list = <span class="keyword">new</span> LinkedList();</span><br><span class="line">list.data = <span class="number">1</span>;</span><br><span class="line">list.tail = list;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">O</span><br><span class="line">    X9a LinkedList      # 类型定义 (假定在类型表中对应key为 0)</span><br><span class="line">    X92</span><br><span class="line">    X04 head</span><br><span class="line">    X04 tail</span><br><span class="line"></span><br><span class="line">o   x90             # 类引用 #0</span><br><span class="line">    x91             # data = 1</span><br><span class="line">    x4b x00         # 下一个条目引用到自身， ref #0</span><br></pre></td></tr></table></figure>
<h3 id="4-12-string"><a href="#4-12-string" class="headerlink" title="4.12. string"></a>4.12. string</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string  ::= s b1 b0 &lt;utf8-data&gt; string</span><br><span class="line">        ::= s b1 b0 &lt;utf8-data&gt;</span><br><span class="line">        ::= [x00-x1f] &lt;utf8-data&gt;</span><br></pre></td></tr></table></figure>
<p>16-bit字符，UTF-8编码的字符串。字符串分块(chunk)编码. x53(‘S’)起头来标识最后一个chunk, x73(‘s’)起头标识非最终chunk. 每个chunk有一个16-bit的长度值字段。
length用来标识字符串的长度，而非字节数量.
String chunks may not split surrogate pairs.</p>
<h4 id="4-12-1-压缩格式-短字符串"><a href="#4-12-1-压缩格式-短字符串" class="headerlink" title="4.12.1. 压缩格式: 短字符串"></a>4.12.1. 压缩格式: 短字符串</h4><p>长度小于32的字符串可以用单字节长的length来标识，范围为[x00-x1f].</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">value = code</span><br></pre></td></tr></table></figure>
<h4 id="4-12-2-字符串实例"><a href="#4-12-2-字符串实例" class="headerlink" title="4.12.2. 字符串实例"></a>4.12.2. 字符串实例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x00                 # &quot;&quot;, 空字符串</span><br><span class="line">x05 hello           # &quot;hello&quot;</span><br><span class="line">x01 xc3 x83         # &quot;\u00c3&quot;</span><br><span class="line"></span><br><span class="line">S   x00 x05 hello   # 长字符串格式的&quot;hello&quot;</span><br><span class="line">s   x00 x07 hello,  # &quot;hello, world&quot;被分割成两个chunk</span><br><span class="line">    X05 world</span><br></pre></td></tr></table></figure>
<h3 id="4-13-类型-type"><a href="#4-13-类型-type" class="headerlink" title="4.13. 类型(type)"></a>4.13. 类型(type)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type    ::= ‘t’ b1 b0 &lt;type-string&gt;</span><br><span class="line">        ::= x4a b0</span><br></pre></td></tr></table></figure>
<p>在面向对象语言中，一个map或list可能包含一个type属性以标识map或list的类型名称。
每个type都被加入到类型表(type map)中，以供将来被引用。</p>
<h3 id="4-14-压缩格式-类型引用"><a href="#4-14-压缩格式-类型引用" class="headerlink" title="4.14. 压缩格式: 类型引用"></a>4.14. 压缩格式: 类型引用</h3><p>Repeated type strings MAY use the type map (type reference) to refer to a previously used type. The type reference is zero-based over all the types encountered during parsing.</p>
<h2 id="5-引用表-Reference-Map"><a href="#5-引用表-Reference-Map" class="headerlink" title="5. 引用表(Reference Map)"></a>5. 引用表(Reference Map)</h2><p><code>Hessian</code> 2.0包含3个内建的引用表：</p>
<ol>
<li>一个map/object/list引用表.</li>
<li>一个类型定义表(class definition map).</li>
<li>一个type(class name)表</li>
</ol>
<p>值引用表使得<code>Hessian</code>支持arbitrary graphs，还有递归和循环数据结构。
class和type表通过消除重复字符串而提高了<code>Hessian</code>的效率。</p>
<h3 id="5-1-值引用"><a href="#5-1-值引用" class="headerlink" title="5.1. 值引用"></a>5.1. 值引用</h3><blockquote>
<p><code>Hessian</code> supports arbitrary graphs by adding list (list), object (object), and map (map) as it encounters them in the bytecode stream。</p>
</blockquote>
<p>解析器必须在引用表中存储每个list, 对象和map。</p>
<p>被存储的对象能够被引用。</p>
<h3 id="5-2-class引用"><a href="#5-2-class引用" class="headerlink" title="5.2. class引用"></a>5.2. class引用</h3><p>每个类型定义被自动添加到类型表(class-map)中。解析器必须在初次使用一个类型时把它添加到类型表中，之后对象实例将通过引用来追踪自身的类型。</p>
<h3 id="5-3-type引用"><a href="#5-3-type引用" class="headerlink" title="5.3. type引用"></a>5.3. type引用</h3><p>map和list的值类型字符串被存储在type map中。解析器必须在初次碰到一个type字符串时把它加入到type map中。</p>
<h2 id="6-字节码映射表-Bytecode-map"><a href="#6-字节码映射表-Bytecode-map" class="headerlink" title="6. 字节码映射表(Bytecode map)"></a>6. 字节码映射表(Bytecode map)</h2><p><code>Hessian</code>被制定成一个字节码协议。<code>Hessian</code>解析器本质上是一段针对头字节的选择分支语句.</p>
<p>字节编码</p>
<table>
<thead>
<tr>
<th>值范围</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>x00 - x1f</td>
<td>utf-8字符串，长度范围 0-32</td>
</tr>
<tr>
<td>x20 - x2f</td>
<td>二进制数据，长度范围 0-16</td>
</tr>
<tr>
<td>x30 - x37</td>
<td>保留</td>
</tr>
<tr>
<td>x38 - x3f</td>
<td>长整型long 范围从-x40000 到 x3ffff</td>
</tr>
<tr>
<td>x40 - x41</td>
<td>保留</td>
</tr>
<tr>
<td>x42</td>
<td>8-bit 二进制数据，表示末尾chunk(‘B’)</td>
</tr>
<tr>
<td>x43</td>
<td>保留(‘C’ streaming call)</td>
</tr>
<tr>
<td>x44</td>
<td>64-bit IEEE 规范编码的双精度浮点double (‘D’)</td>
</tr>
<tr>
<td>x45</td>
<td>保留(‘E’ envelope)</td>
</tr>
<tr>
<td>x46</td>
<td>boolean false (‘F’)</td>
</tr>
<tr>
<td>x47</td>
<td>保留</td>
</tr>
<tr>
<td>x48</td>
<td>保留 (‘H’ header)</td>
</tr>
<tr>
<td>x49</td>
<td>32-bit有符号整型signed integer (‘I’)</td>
</tr>
<tr>
<td>x4a</td>
<td>引用(ref)，范围为1-256th</td>
</tr>
<tr>
<td>x4b</td>
<td>引用(ref)，范围为1-65536th</td>
</tr>
<tr>
<td>x4c</td>
<td>64-bit有符号长整型long integer (‘L’)</td>
</tr>
<tr>
<td>x4d</td>
<td>具有可选类型的map (‘M’)</td>
</tr>
<tr>
<td>x4e</td>
<td>null (‘N’)</td>
</tr>
<tr>
<td>x4f</td>
<td>类型定义(‘O’)</td>
</tr>
<tr>
<td>x50</td>
<td>保留(‘P’ streaming message/post)</td>
</tr>
<tr>
<td>x51</td>
<td>保留</td>
</tr>
<tr>
<td>x52</td>
<td>引用(ref)，取值范围对应于整型int (‘R’)</td>
</tr>
<tr>
<td>x53</td>
<td>utf-8字符串，末尾chunk (‘S’)</td>
</tr>
<tr>
<td>x54</td>
<td>boolean true (‘T’)</td>
</tr>
<tr>
<td>x55</td>
<td>保留</td>
</tr>
<tr>
<td>x56</td>
<td>list/vector (‘V’)</td>
</tr>
<tr>
<td>x57 - x62</td>
<td>保留</td>
</tr>
<tr>
<td>x62</td>
<td>8-bit二进制数据，非末尾chunk (‘b’)</td>
</tr>
<tr>
<td>x63</td>
<td>保留 (‘c’ call for RPC)</td>
</tr>
<tr>
<td>x64</td>
<td>UTC time encoded as 64-bit long milliseconds since epoch (‘d’)</td>
</tr>
<tr>
<td>x65</td>
<td>保留</td>
</tr>
<tr>
<td>x66</td>
<td>保留(‘f’ for fault for RPC)</td>
</tr>
<tr>
<td>x67</td>
<td>double 0.0</td>
</tr>
<tr>
<td>x68</td>
<td>double 1.0</td>
</tr>
<tr>
<td>x69</td>
<td>double represented as byte (-128.0 to 127.0)</td>
</tr>
<tr>
<td>x6a</td>
<td>double represented as short (-32768.0 to 327676.0)</td>
</tr>
<tr>
<td>x6b</td>
<td>double represented as float</td>
</tr>
<tr>
<td>x6c</td>
<td>list/vector length (‘l’)</td>
</tr>
<tr>
<td>x6d</td>
<td>保留 (‘m’ method for RPC call)</td>
</tr>
<tr>
<td>x6e</td>
<td>list/vector compact length</td>
</tr>
<tr>
<td>x6f</td>
<td>对象实例(‘o’)</td>
</tr>
<tr>
<td>x70</td>
<td>保留 (‘p’ - message/post)</td>
</tr>
<tr>
<td>x71</td>
<td>保留</td>
</tr>
<tr>
<td>x72</td>
<td>保留(‘r’ reply for message/RPC)</td>
</tr>
<tr>
<td>x73</td>
<td>utf-8字符串，非末尾chunk (‘s’)</td>
</tr>
<tr>
<td>x74</td>
<td>map/list type (‘t’)</td>
</tr>
<tr>
<td>x75</td>
<td>type-ref</td>
</tr>
<tr>
<td>x76</td>
<td>压缩格式的vector (‘v’)</td>
</tr>
<tr>
<td>x77</td>
<td>以32-bit整型编码的long</td>
</tr>
<tr>
<td>x78 - x79</td>
<td>保留</td>
</tr>
<tr>
<td>x7a</td>
<td>list/map 终止符(‘z’)</td>
</tr>
<tr>
<td>x7b - x7f</td>
<td>保留</td>
</tr>
<tr>
<td>x80 - xbf</td>
<td>单字节压缩格式的整型int(-x10 to x3f, x90 is 0)</td>
</tr>
<tr>
<td>xc0 - xcf</td>
<td>双字节压缩格式的整型int(-x800 to x3ff)</td>
</tr>
<tr>
<td>xd0 - xd7</td>
<td>三字节压缩格式的整型int(-x40000 to x3ffff)</td>
</tr>
<tr>
<td>xd8 - xef</td>
<td>单字节压缩格式的长整型long(-x8 to x10, xe0 is 0)</td>
</tr>
<tr>
<td>xf0 - xff</td>
<td>双字节压缩格式的长整型long (-x800 to x3ff, xf8 is 0)</td>
</tr>
</tbody>
</table>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2>
      
    </div>

    
      
      

  <div class="post-copyright">
    <p class="copyright-item">
      <span>Author: </span>
      <a href="https://cytle.github.io">炒饭</a>
    </p>
    <p class="copyright-item">
      <span>Link: </span>
      <a href="https://cytle.github.io/2016/09/22/Hessian-2-0序列化协议规范/">https://cytle.github.io/2016/09/22/Hessian-2-0序列化协议规范/</a>
    </p>
    <p class="copyright-item">
      <span>License: </span>
      
      <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>
    </p>
  </div>



      
      
    

    
      <footer class="post-footer">
        
          <div class="post-tags">
            
              <a href="/tags/Hessian/">Hessian</a>
            
          </div>
        
        
        
  <nav class="post-nav">
    
      <a class="prev" href="/2016/09/24/Hessian-调用java重载方法/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text nav-default">Hessian-调用java重载方法</span>
        <span class="prev-text nav-mobile">Prev</span>
      </a>
    
    
  </nav>

      </footer>
    

  </article>


          </div>
          
  <div class="comments" id="comments">
    
  </div>


        </div>
      </main>

      <footer id="footer" class="footer">

  <div class="social-links">
    
      
        
          <a href="mailto:canyoutle@gmail.com" class="iconfont icon-email" title="email"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
        
          <a href="https://github.com/cytle" class="iconfont icon-github" title="github"></a>
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
    
    
      <a href="/atom.xml" class="iconfont icon-rss" title="rss"></a>
    
  </div>


<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://hexo.io/">Hexo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/ahonn/hexo-theme-even">Even</a>
  </span>

  <span class="copyright-year">
    
    &copy; 
     
      2015 - 
    
    2017

    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">炒饭</span>
  </span>
</div>

      </footer>

      <div class="back-to-top" id="back-to-top">
        <i class="iconfont icon-up"></i>
      </div>
    </div>

    
  



    




  
    <script type="text/javascript" src="/lib/jquery/jquery-3.1.1.min.js"></script>
  

  
    <script type="text/javascript" src="/lib/slideout/slideout.js"></script>
  

  


    <script type="text/javascript" src="/js/src/even.js?v=2.6.0"></script>
<script type="text/javascript" src="/js/src/bootstrap.js?v=2.6.0"></script>

  </body>
</html>
